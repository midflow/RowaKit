/**
 * Demo 02: Columns & Formatting
 * Shows different column types and formatting options
 */

import { RowaKitTable, col } from '@rowakit/table';
import type { Fetcher } from '@rowakit/table';

interface Product {
  id: string;
  name: string;
  category: string;
  price: number;
  stock: number;
}

const MOCK_DATA: Product[] = [
  { id: '1', name: 'Laptop', category: 'Electronics', price: 1299.99, stock: 15 },
  { id: '2', name: 'Mouse', category: 'Accessories', price: 29.99, stock: 150 },
  { id: '3', name: 'Cable', category: 'Accessories', price: 19.99, stock: 500 },
];

const fetchProducts: Fetcher<Product> = async (query) => {
  await new Promise((r) => setTimeout(r, 300));
  let data = [...MOCK_DATA];

  if (query.sort) {
    data.sort((a, b) => {
      const av = a[query.sort!.field as keyof Product];
      const bv = b[query.sort!.field as keyof Product];
      const cmp = av < bv ? -1 : av > bv ? 1 : 0;
      return query.sort!.direction === 'asc' ? cmp : -cmp;
    });
  }

  const start = (query.page - 1) * query.pageSize;
  return {
    items: data.slice(start, start + query.pageSize),
    total: data.length,
  };
};

export default function ColumnsFormattingDemo() {
  return (
    <RowaKitTable
      fetcher={fetchProducts}
      columns={[
        col.text<Product>('name', { sortable: true, header: 'Product' }),
        col.text<Product>('category', { sortable: true }),
        col.number<Product>('price', {
          sortable: true,
          format: (v) => `$${v.toFixed(2)}`,
          align: 'right',
        }),
        col.number<Product>('stock', {
          sortable: true,
          format: (v) => v.toLocaleString(),
          align: 'right',
        }),
      ]}
      rowKey="id"
      defaultPageSize={10}
    />
  );
}
